name: Publish Packages

on:
    workflow_dispatch:
    push:
        branches:
            - release
            - master

env:
    nodeTestTimeout: 4000
    browserTestTimeout: 8000
    DETECT_CHROMEDRIVER_VERSION: true
    HARP_NO_HARD_SOURCE_CACHE: true

jobs:
    deploy:
        name: Deploy coresdk packages
        runs-on: ubuntu-latest

        steps:
            - name: Setup Node
              uses: actions/setup-node@v1
              with:
                  node-version: 14
                  registry-url: https://registry.npmjs.org/
              env:
                  NODE_AUTH_TOKEN: ${{secrets.NPM_TOKEN}}

            - name: Fix NPM tags
              run: |
                npm unpublish @here/harp-examples@v0.22.1
              shell: bash
              env:
                  NODE_AUTH_TOKEN: ${{secrets.NPM_TOKEN}}
